// ğŸš€ HayDay Chat Quick Debug - Browser Console'da Ã§alÄ±ÅŸtÄ±r
// F12 basÄ±p Console tab'Ä±nda bu kodu yapÄ±ÅŸtÄ±r

console.log('ğŸš€ HayDay Chat Debug BaÅŸlatÄ±lÄ±yor...');

// 1. Server Connection Test
async function testServer() {
    try {
        const response = await fetch('/ping');
        const data = await response.json();
        console.log('âœ… Server Status:', data);
        return true;
    } catch (error) {
        console.error('âŒ Server Error:', error);
        return false;
    }
}

// 2. Chat API Test
async function testChatAPI(message = 'test mesajÄ±') {
    const clientId = 'debug_' + Date.now();
    
    try {
        console.log(`ğŸ“¤ Mesaj gÃ¶nderiliyor: "${message}"`);
        
        const response = await fetch('/api/chat/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                clientId: clientId,
                message: message
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            console.log('âœ… Chat API Success:', data);
            console.log(`ğŸ“¥ Bot Response: "${data.reply}"`);
            console.log(`ğŸ¤– Role: ${data.role}`);
            console.log(`ğŸ“Š Confidence: ${data.confidence}`);
            return data;
        } else {
            console.error('âŒ Chat API Error:', data);
            return null;
        }
    } catch (error) {
        console.error('âŒ Network Error:', error);
        return null;
    }
}

// 3. Environment Check
function checkEnvironment() {
    console.log('ğŸŒ Environment Check:');
    console.log('URL:', window.location.href);
    console.log('Origin:', window.location.origin);
    console.log('User Agent:', navigator.userAgent);
    console.log('Online:', navigator.onLine);
}

// 4. Network Analysis
async function analyzeNetwork() {
    console.log('ğŸ“¡ Network Analysis:');
    
    // Test different endpoints
    const endpoints = ['/ping', '/api/chat/send', '/admin.html'];
    
    for (const endpoint of endpoints) {
        try {
            const start = performance.now();
            const response = await fetch(endpoint, { method: 'HEAD' });
            const duration = Math.round(performance.now() - start);
            
            console.log(`${endpoint}: ${response.status} (${duration}ms)`);
        } catch (error) {
            console.log(`${endpoint}: Error - ${error.message}`);
        }
    }
}

// 5. LocalStorage Check
function checkStorage() {
    console.log('ğŸ’¾ Storage Check:');
    
    try {
        const clientId = localStorage.getItem('hayday_chat_client_id');
        console.log('Client ID:', clientId);
        
        const keys = Object.keys(localStorage).filter(key => 
            key.includes('chat') || key.includes('hayday')
        );
        console.log('Chat Keys:', keys);
    } catch (error) {
        console.error('Storage Error:', error);
    }
}

// Ana Test Fonksiyonu
async function runFullDiagnostic() {
    console.log('ğŸ” === HAYDAY CHAT DIAGNOSTIC BAÅLIYOR ===');
    
    // Environment
    checkEnvironment();
    
    // Storage
    checkStorage();
    
    // Network
    await analyzeNetwork();
    
    // Server Test
    const serverOK = await testServer();
    if (!serverOK) {
        console.log('âŒ Server baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z, chat testi iptal edildi');
        return;
    }
    
    // Chat Test
    console.log('\nğŸ“± Chat API Testi:');
    const testMessages = ['merhaba', 'altÄ±n transfer', 'fiyat listesi'];
    
    for (const msg of testMessages) {
        const result = await testChatAPI(msg);
        if (result) {
            console.log(`âœ… "${msg}" â†’ "${result.reply}"`);
        }
        // 1 saniye bekle
        await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    console.log('ğŸ === DIAGNOSTIC TAMAMLANDI ===');
}

// Error Handler
window.addEventListener('error', (e) => {
    console.error('ğŸš¨ Global Error:', e.error);
});

// Network Error Handler  
window.addEventListener('unhandledrejection', (e) => {
    console.error('ğŸš¨ Promise Rejection:', e.reason);
});

// Otomatik baÅŸlat
console.log('âš¡ Quick Debug yÃ¼klendi!');
console.log('ğŸ“ Komutlar:');
console.log('  - runFullDiagnostic() : Tam teÅŸhis');
console.log('  - testChatAPI("mesaj") : Chat test');
console.log('  - testServer() : Server test');

// 2 saniye sonra otomatik baÅŸlat
setTimeout(() => {
    console.log('ğŸš€ Otomatik diagnostic baÅŸlatÄ±lÄ±yor...');
    runFullDiagnostic();
}, 2000);
